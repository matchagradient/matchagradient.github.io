<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barnsley Fern Explorer</title>
    <link rel="stylesheet" href="/assets/css/styles.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            position: relative;
        }
        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 100;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        .logo a {
            color: #ffffff;
            text-decoration: none;
            font-weight: 600;
            font-size: 18px;
        }
        .nav-links {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        .nav-links a {
            color: #ffffff;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        .nav-links a:hover {
            color: #22c55e;
        }
        #canvas-container {
            position: relative;
            height: 100vh;
            width: 100%;
        }
        #canvas {
            display: block;
            cursor: grab;
            background: #000;
            width: 100%;
            height: 100%;
        }
        #canvas:active {
            cursor: grabbing;
        }
        .controls {
            position: absolute;
            top: 80px;
            right: 20px;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 200px;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            z-index: 10;
        }
        .controls h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #fff;
            font-weight: 600;
        }
        .direction-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }
        .direction-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        .direction-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        .direction-btn:active {
            transform: translateY(0);
        }
        .direction-btn.center {
            grid-column: 2;
            grid-row: 2;
        }
        .zoom-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .zoom-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        .zoom-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        .reset-btn {
            width: 100%;
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.5);
            color: #22c55e;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            margin-bottom: 20px;
        }
        .reset-btn:hover {
            background: rgba(34, 197, 94, 0.3);
            transform: translateY(-1px);
        }
        .info {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.6;
        }
        .info-item {
            margin-bottom: 8px;
        }
        .info-label {
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 20, 20, 0.95);
            padding: 20px 40px;
            border-radius: 12px;
            display: none;
            align-items: center;
            gap: 15px;
            z-index: 20;
        }
        .loading.active {
            display: flex;
        }
        .spinner {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-top-color: #22c55e;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .color-scheme, .locations, .export-section {
            margin-bottom: 20px;
        }
        .color-scheme label, .locations label, .export-section label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }
        .color-scheme select, .locations select {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        .color-scheme select option, .locations select option {
            background: #1a1a1a;
        }
        .performance-controls {
            margin-bottom: 20px;
        }
        .quality-slider {
            width: 100%;
            margin-top: 10px;
        }
        .quality-labels {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 5px;
        }
        .export-btn {
            width: 100%;
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.5);
            color: #22c55e;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        .export-btn:hover {
            background: rgba(34, 197, 94, 0.3);
            transform: translateY(-1px);
        }
        .export-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(34, 197, 94, 0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 100;
        }
        .notification.show {
            opacity: 1;
        }
        
        /* Introduction section styles */
        .introduction {
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 20px;
            background: #111;
        }
        .introduction h1 {
            font-size: 42px;
            margin-bottom: 20px;
            color: #fff;
            font-weight: 700;
        }
        .introduction h2 {
            font-size: 28px;
            margin-top: 40px;
            margin-bottom: 15px;
            color: #22c55e;
            font-weight: 600;
        }
        .introduction p {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.8);
        }
        .introduction .highlight {
            color: #22c55e;
            font-weight: 500;
        }
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-5px);
        }
        .feature-card h3 {
            font-size: 22px;
            margin-bottom: 15px;
            color: #fff;
        }
        .feature-card p {
            font-size: 16px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.7);
        }
        .formula {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: #22c55e;
            overflow-x: auto;
        }
        
        @media (max-width: 640px) {
            .controls {
                top: 70px;
                right: 10px;
                padding: 15px;
                min-width: 160px;
                max-height: calc(100vh - 90px);
            }
            .direction-btn {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
            .zoom-btn {
                padding: 8px;
                font-size: 14px;
            }
            .introduction h1 {
                font-size: 32px;
            }
            .introduction h2 {
                font-size: 24px;
            }
            .introduction p {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <div class="logo"><a href="/index.html">Mike Wang</a></div>
            <ul class="nav-links external-links">
                <li><a href="/collections.html">Collections</a></li>
            </ul>
        </div>
    </nav>
    
    <div id="canvas-container">
        <canvas id="canvas"></canvas>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <span>Rendering...</span>
        </div>
        <div class="controls">
            <h2>Barnsley Fern Explorer</h2>
            
            <div class="direction-controls">
                <div></div>
                <button class="direction-btn" data-direction="up">↑</button>
                <div></div>
                <button class="direction-btn" data-direction="left">←</button>
                <button class="direction-btn center" data-direction="reset">⌂</button>
                <button class="direction-btn" data-direction="right">→</button>
                <div></div>
                <button class="direction-btn" data-direction="down">↓</button>
                <div></div>
            </div>
            <div class="zoom-controls">
                <button class="zoom-btn" id="zoomIn">Zoom In</button>
                <button class="zoom-btn" id="zoomOut">Zoom Out</button>
            </div>
            <button class="reset-btn" id="resetView">Reset View</button>
            <div class="locations">
                <label for="locationSelect">Interesting Views</label>
                <select id="locationSelect">
                    <option value="">Select a view...</option>
                    <option value="full">Full Fern</option>
                    <option value="stem">Stem Detail</option>
                    <option value="leaf">Leaf Pattern</option>
                    <option value="fractal">Fractal Edge</option>
                    <option value="symmetry">Symmetry View</option>
                </select>
            </div>
            <div class="color-scheme">
                <label for="colorScheme">Color Scheme</label>
                <select id="colorScheme">
                    <option value="classic">Classic Green</option>
                    <option value="autumn">Autumn</option>
                    <option value="monochrome">Monochrome</option>
                    <option value="rainbow">Rainbow</option>
                    <option value="ocean">Ocean</option>
                </select>
            </div>
            <div class="performance-controls">
                <label for="quality">Point Density</label>
                <input type="range" id="quality" class="quality-slider" min="1" max="5" value="3">
                <div class="quality-labels">
                    <span>Low</span>
                    <span>Medium</span>
                    <span>High</span>
                </div>
            </div>
            <div class="export-section">
                <button class="export-btn" id="exportBtn">Export as Image</button>
            </div>
            <div class="info">
                <div class="info-item">
                    <span class="info-label">Zoom:</span> <span id="zoomLevel">1.0x</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Points:</span> <span id="pointCount">50,000</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Iterations:</span> <span id="iterations">50,000</span>
                </div>
            </div>
        </div>
        <div class="notification" id="notification"></div>
    </div>
    
    <section class="introduction">
        <h1>The Barnsley Fern</h1>
        <p>
            The <span class="highlight">Barnsley Fern</span> is a remarkable fractal that mimics the appearance of a natural fern. 
            Created by mathematician Michael Barnsley, it's generated using an iterated function system (IFS) that applies 
            affine transformations with specific probabilities. Unlike the Mandelbrot Set, which is based on complex numbers, 
            the Barnsley Fern is created through a simple but elegant algorithm.
        </p>
        
        <div class="formula">
            f₁(x,y) = (0, 0.16y) with probability 0.01<br>
            f₂(x,y) = (0.85x + 0.04y, -0.04x + 0.85y + 1.6) with probability 0.85<br>
            f₃(x,y) = (0.2x - 0.26y, 0.23x + 0.22y + 1.6) with probability 0.07<br>
            f₄(x,y) = (-0.15x + 0.28y, 0.26x + 0.24y + 0.44) with probability 0.07
        </div>
        
        <p>
            Starting with a point at the origin (0,0), the algorithm repeatedly applies one of these four transformations, 
            chosen at random according to their probabilities. After thousands of iterations, the points form the intricate 
            pattern of a fern, demonstrating how simple mathematical rules can create complex, natural-looking structures.
        </p>
        
        <h2>Mathematical Beauty</h2>
        <p>
            What makes the Barnsley Fern fascinating is its <span class="highlight">self-similar structure</span>. Each leaflet 
            of the fern is a miniature copy of the entire fern, and each leaflet of those leaflets is also a copy, and so on. 
            This recursive property is a hallmark of fractals and appears throughout nature in structures like ferns, trees, 
            coastlines, and clouds.
        </p>
        <p>
            The interactive explorer above allows you to examine this fractal in detail. You can zoom in to see the self-similar 
            patterns at different scales, pan around to explore different parts of the fern, and adjust the visualization to 
            highlight different aspects of its structure.
        </p>
        
        <h2>Features of the Explorer</h2>
        <div class="features">
            <div class="feature-card">
                <h3>Interactive Navigation</h3>
                <p>Use your mouse to drag and pan around the fern, scroll to zoom in and out, or use the control buttons for precise navigation.</p>
            </div>
            <div class="feature-card">
                <h3>Interesting Views</h3>
                <p>Jump to pre-selected views that highlight different aspects of the fern, from the overall structure to detailed leaf patterns.</p>
            </div>
            <div class="feature-card">
                <h3>Customizable Visualization</h3>
                <p>Choose from different color schemes to visualize the fern in unique ways, from classic green to vibrant rainbow colors.</p>
            </div>
            <div class="feature-card">
                <h3>Point Density Control</h3>
                <p>Adjust the number of points used to render the fern, balancing between rendering speed and visual detail.</p>
            </div>
            <div class="feature-card">
                <h3>Export Images</h3>
                <p>Capture and save your favorite views of the Barnsley Fern as high-quality PNG images.</p>
            </div>
            <div class="feature-card">
                <h3>Real-time Information</h3>
                <p>Monitor your current zoom level, point count, and iteration count as you explore the fractal.</p>
            </div>
        </div>
        
        <h2>Applications and Significance</h2>
        <p>
            Beyond its aesthetic appeal, the Barnsley Fern has practical applications in computer graphics, data compression, 
            and modeling natural phenomena. It's a prime example of how fractal geometry can be used to create realistic 
            computer-generated images of plants and landscapes.
        </p>
        <p>
            The fern also demonstrates the concept of "chaos game" - a method of generating fractals by randomly applying 
            transformations. This approach shows how order and structure can emerge from seemingly random processes, a 
            principle that appears in many areas of science and nature.
        </p>
    </section>
    
    <script>
        class BarnsleyFernExplorer {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.loading = document.getElementById('loading');
                this.notification = document.getElementById('notification');
                
                // View parameters
                this.centerX = 0;
                this.centerY = 0;
                this.zoom = 1;
                this.basePointCount = 50000;
                this.pointCount = this.basePointCount;
                this.colorScheme = 'classic';
                
                // Performance settings
                this.qualityLevel = 3; // 1-5 (low to high density)
                
                // Interaction state
                this.isDragging = false;
                this.lastX = 0;
                this.lastY = 0;
                
                // Rendering state
                this.isRendering = false;
                this.points = [];
                
                // Barnsley Fern transformations
                this.transformations = [
                    { a: 0, b: 0, c: 0, d: 0.16, e: 0, f: 0, p: 0.01 },      // Stem
                    { a: 0.85, b: 0.04, c: -0.04, d: 0.85, e: 0, f: 1.6, p: 0.85 }, // Main leaf
                    { a: 0.2, b: -0.26, c: 0.23, d: 0.22, e: 0, f: 1.6, p: 0.07 },  // Left leaf
                    { a: -0.15, b: 0.28, c: 0.26, d: 0.24, e: 0, f: 0.44, p: 0.07 } // Right leaf
                ];
                
                // Interesting locations
                this.interestingLocations = {
                    full: { name: "Full Fern", x: 0, y: 4.5, zoom: 1 },
                    stem: { name: "Stem Detail", x: 0, y: 1, zoom: 5 },
                    leaf: { name: "Leaf Pattern", x: -2, y: 3, zoom: 8 },
                    fractal: { name: "Fractal Edge", x: 2.5, y: 6, zoom: 15 },
                    symmetry: { name: "Symmetry View", x: 0, y: 4.5, zoom: 2 }
                };
                
                this.init();
            }
            init() {
                this.resizeCanvas();
                this.setupEventListeners();
                this.render();
                
                window.addEventListener('resize', () => {
                    this.resizeCanvas();
                    this.render();
                });
            }
            resizeCanvas() {
                // Set canvas size to match container
                const container = document.getElementById('canvas-container');
                this.canvas.width = container.clientWidth;
                this.canvas.height = container.clientHeight;
            }
            setupEventListeners() {
                // Mouse events
                this.canvas.addEventListener('mousedown', (e) => this.startDrag(e));
                this.canvas.addEventListener('mousemove', (e) => this.drag(e));
                this.canvas.addEventListener('mouseup', () => this.endDrag());
                this.canvas.addEventListener('mouseleave', () => this.endDrag());
                
                // Touch events
                this.canvas.addEventListener('touchstart', (e) => this.startDrag(e.touches[0]));
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    this.drag(e.touches[0]);
                });
                this.canvas.addEventListener('touchend', () => this.endDrag());
                
                // Wheel zoom
                this.canvas.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    const delta = e.deltaY > 0 ? 0.9 : 1.1;
                    this.zoomAt(e.clientX, e.clientY, delta);
                });
                
                // Direction controls
                document.querySelectorAll('.direction-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const direction = btn.dataset.direction;
                        if (direction === 'reset') {
                            this.resetView();
                        } else {
                            this.pan(direction);
                        }
                    });
                });
                
                // Zoom buttons
                document.getElementById('zoomIn').addEventListener('click', () => {
                    this.zoomAt(this.canvas.width / 2, this.canvas.height / 2, 1.5);
                });
                
                document.getElementById('zoomOut').addEventListener('click', () => {
                    this.zoomAt(this.canvas.width / 2, this.canvas.height / 2, 0.67);
                });
                
                // Reset view
                document.getElementById('resetView').addEventListener('click', () => {
                    this.resetView();
                });
                
                // Location selector
                document.getElementById('locationSelect').addEventListener('change', (e) => {
                    const locationKey = e.target.value;
                    if (locationKey && this.interestingLocations[locationKey]) {
                        this.navigateToLocation(this.interestingLocations[locationKey]);
                        e.target.value = ''; // Reset selector
                    }
                });
                
                // Color scheme
                document.getElementById('colorScheme').addEventListener('change', (e) => {
                    this.colorScheme = e.target.value;
                    this.render();
                });
                
                // Quality slider
                document.getElementById('quality').addEventListener('input', (e) => {
                    this.qualityLevel = parseInt(e.target.value);
                    this.updatePointCount();
                    this.render();
                });
                
                // Export button
                document.getElementById('exportBtn').addEventListener('click', () => {
                    this.exportImage();
                });
            }
            startDrag(e) {
                this.isDragging = true;
                this.lastX = e.clientX;
                this.lastY = e.clientY;
            }
            drag(e) {
                if (!this.isDragging) return;
                
                const dx = e.clientX - this.lastX;
                const dy = e.clientY - this.lastY;
                
                const scale = 10 / (this.zoom * Math.min(this.canvas.width, this.canvas.height));
                this.centerX -= dx * scale;
                this.centerY -= dy * scale;
                
                this.lastX = e.clientX;
                this.lastY = e.clientY;
                
                this.updateInfo();
                this.render();
            }
            endDrag() {
                this.isDragging = false;
            }
            pan(direction) {
                const moveAmount = 1 / this.zoom;
                
                switch(direction) {
                    case 'up':
                        this.centerY -= moveAmount;
                        break;
                    case 'down':
                        this.centerY += moveAmount;
                        break;
                    case 'left':
                        this.centerX -= moveAmount;
                        break;
                    case 'right':
                        this.centerX += moveAmount;
                        break;
                }
                
                this.updateInfo();
                this.render();
            }
            zoomAt(x, y, factor) {
                const scale = 10 / (this.zoom * Math.min(this.canvas.width, this.canvas.height));
                const worldX = this.centerX + (x - this.canvas.width / 2) * scale;
                const worldY = this.centerY + (y - this.canvas.height / 2) * scale;
                
                this.zoom *= factor;
                
                const newScale = 10 / (this.zoom * Math.min(this.canvas.width, this.canvas.height));
                this.centerX = worldX - (x - this.canvas.width / 2) * newScale;
                this.centerY = worldY - (y - this.canvas.height / 2) * newScale;
                
                this.updateInfo();
                this.render();
            }
            updatePointCount() {
                // Adjust point count based on quality level
                this.pointCount = Math.floor(this.basePointCount * (0.5 + this.qualityLevel * 0.3));
            }
            resetView() {
                this.centerX = 0;
                this.centerY = 4.5;
                this.zoom = 1;
                this.updateInfo();
                this.render();
            }
            navigateToLocation(location) {
                this.centerX = location.x;
                this.centerY = location.y;
                this.zoom = location.zoom;
                this.updateInfo();
                this.showNotification(`Navigated to ${location.name}`);
                this.render();
            }
            render() {
                if (this.isRendering) return;
                
                this.isRendering = true;
                this.loading.classList.add('active');
                
                // Use setTimeout to allow the UI to update
                setTimeout(() => {
                    this.generateFern();
                    this.isRendering = false;
                    this.loading.classList.remove('active');
                }, 10);
            }
            generateFern() {
                // Clear the canvas
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Generate points for the Barnsley Fern
                this.points = [];
                let x = 0;
                let y = 0;
                
                // Generate points
                for (let i = 0; i < this.pointCount; i++) {
                    // Choose a transformation based on probability
                    const r = Math.random();
                    let sum = 0;
                    let transformation = this.transformations[0];
                    
                    for (const t of this.transformations) {
                        sum += t.p;
                        if (r <= sum) {
                            transformation = t;
                            break;
                        }
                    }
                    
                    // Apply the transformation
                    const newX = transformation.a * x + transformation.b * y + transformation.e;
                    const newY = transformation.c * x + transformation.d * y + transformation.f;
                    
                    x = newX;
                    y = newY;
                    
                    // Skip the first few points to allow the system to stabilize
                    if (i > 10) {
                        this.points.push({ x, y });
                    }
                }
                
                // Draw the points
                this.drawPoints();
            }
            drawPoints() {
                // Calculate scale and offset
                const scale = Math.min(this.canvas.width, this.canvas.height) / 10 * this.zoom;
                const offsetX = this.canvas.width / 2 - this.centerX * scale;
                const offsetY = this.canvas.height / 2 - this.centerY * scale;
                
                // Draw each point
                for (const point of this.points) {
                    const screenX = point.x * scale + offsetX;
                    const screenY = this.canvas.height - (point.y * scale + offsetY); // Flip Y axis
                    
                    // Skip points outside the canvas
                    if (screenX < 0 || screenX >= this.canvas.width || screenY < 0 || screenY >= this.canvas.height) {
                        continue;
                    }
                    
                    // Get color based on scheme and point position
                    const color = this.getColor(point.x, point.y);
                    
                    // Draw the point
                    this.ctx.fillStyle = color;
                    this.ctx.fillRect(screenX, screenY, 1, 1);
                }
            }
            getColor(x, y) {
                switch(this.colorScheme) {
                    case 'classic':
                        // Classic green fern with gradient based on height
                        const greenIntensity = Math.min(255, 100 + Math.floor(y * 30));
                        return `rgb(0, ${greenIntensity}, 0)`;
                    
                    case 'autumn':
                        // Autumn colors based on height
                        const t = Math.min(1, y / 10);
                        const r = Math.floor(200 + t * 55);
                        const g = Math.floor(150 - t * 50);
                        const b = Math.floor(50 - t * 50);
                        return `rgb(${r}, ${g}, ${b})`;
                    
                    case 'monochrome':
                        // Monochrome based on height
                        const gray = Math.min(255, 100 + Math.floor(y * 30));
                        return `rgb(${gray}, ${gray}, ${gray})`;
                    
                    case 'rainbow':
                        // Rainbow colors based on position
                        const hue = (x * 50 + y * 30) % 360;
                        return this.hslToRgb(hue, 80, 50);
                    
                    case 'ocean':
                        // Ocean colors based on height
                        const blueIntensity = Math.min(255, 100 + Math.floor(y * 30));
                        const greenIntensity2 = Math.min(255, 50 + Math.floor(y * 20));
                        return `rgb(0, ${greenIntensity2}, ${blueIntensity})`;
                    
                    default:
                        return '#00ff00'; // Default green
                }
            }
            hslToRgb(h, s, l) {
                h /= 360;
                s /= 100;
                l /= 100;
                
                let r, g, b;
                
                if (s === 0) {
                    r = g = b = l;
                } else {
                    const hue2rgb = (p, q, t) => {
                        if (t < 0) t += 1;
                        if (t > 1) t -= 1;
                        if (t < 1/6) return p + (q - p) * 6 * t;
                        if (t < 1/2) return q;
                        if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                        return p;
                    };
                    
                    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                    const p = 2 * l - q;
                    r = hue2rgb(p, q, h + 1/3);
                    g = hue2rgb(p, q, h);
                    b = hue2rgb(p, q, h - 1/3);
                }
                
                return `rgb(${Math.round(r * 255)}, ${Math.round(g * 255)}, ${Math.round(b * 255)})`;
            }
            exportImage() {
                // Disable export button during export
                const exportBtn = document.getElementById('exportBtn');
                exportBtn.disabled = true;
                exportBtn.textContent = 'Exporting...';
                
                // Create a temporary canvas to ensure full quality export
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = this.canvas.width;
                tempCanvas.height = this.canvas.height;
                
                // Copy the current canvas content
                tempCtx.drawImage(this.canvas, 0, 0);
                
                // Convert to data URL
                const dataURL = tempCanvas.toDataURL('image/png');
                
                // Create download link
                const link = document.createElement('a');
                link.download = `barnsley_fern_${Date.now()}.png`;
                link.href = dataURL;
                
                // Trigger download
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Re-enable export button
                exportBtn.disabled = false;
                exportBtn.textContent = 'Export as Image';
                
                // Show notification
                this.showNotification('Image exported successfully!');
            }
            showNotification(message) {
                this.notification.textContent = message;
                this.notification.classList.add('show');
                
                setTimeout(() => {
                    this.notification.classList.remove('show');
                }, 3000);
            }
            updateInfo() {
                document.getElementById('zoomLevel').textContent = this.zoom.toFixed(2) + 'x';
                document.getElementById('pointCount').textContent = this.pointCount.toLocaleString();
                document.getElementById('iterations').textContent = this.pointCount.toLocaleString();
            }
        }
        // Initialize the explorer when the page loads
        const explorer = new BarnsleyFernExplorer();
    </script>
</body>
</html>